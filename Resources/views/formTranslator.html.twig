{% macro translate_form_label(form, translationDomain = null) -%}
    {% import _self as self -%}

    {% if form.vars.label is not empty or form.vars.label_format is not empty -%}
        {% set label = form.vars.label_format|replace({'%name%': form.vars.name, '%id%': form.vars.id})|default(form.vars.label) -%}

        {% if translationDomain is same as(false) -%}
            {{ label -}}
        {% else -%}
            {{ label|trans({}, translationDomain) -}}
        {% endif -%}
    {% else -%}
        {{ self.translate_recursive(self.form_path(form), translationDomain) -}}
    {% endif -%}
{% endmacro %}

{% macro translate_recursive(id, translationDomain = null, currentPath = null, includeFallback = false) -%}
    {% import _self as self -%}

    {% set currentId = currentPath is same as(null) ? id : currentPath|join('.') -%}
    {% set currentPath = currentPath ?? id|split('.') -%}

    {% if is_translated(currentId, translationDomain, null, includeFallback) -%}
        {{ currentId|trans({}, translationDomain) -}}
    {% elseif currentPath|length > 1 -%}
        {{ self.translate_recursive(id, translationDomain, currentPath|slice(1)) -}}
    {% elseif not useFallback -%}
        {{ self.translate_recursive(id, translationDomain, null, true) -}}
    {% else -%}
        {{ currentId -}}
    {% endif -%}
{% endmacro %}

{% macro form_path(form, currentPath = null) -%}
    {% import _self as self -%}

    {% if 'collection' not in form.parent.vars.block_prefixes ?? [] and 'a2lix_translations' not in form.parent.vars.block_prefixes ?? [] -%}
        {% set currentPath = currentPath is same as(null) ? form.vars.name : "#{form.vars.name}.#{currentPath}" -%}
    {% endif -%}

    {% if form.parent -%}
        {{ self.form_path(form.parent, currentPath) -}}
    {% else -%}
        {{ currentPath -}}
    {% endif -%}
{% endmacro %}
